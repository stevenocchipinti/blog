---
import { getCollection, type CollectionEntry } from "astro:content"
import { Image } from "astro:assets"

import BaseHead from "../../../components/BaseHead.astro"
import Header from "../../../components/Header.astro"
import Footer from "../../../components/Footer.astro"
import { SITE_TITLE, SITE_DESCRIPTION } from "../../../consts"
import placeholder from "../../../assets/placeholder-trip.jpg"

export async function getStaticPaths() {
  const allPosts = await getCollection("travel")
  const trips = await getCollection("trips")

  return trips.map(trip => {
    const posts = allPosts
      .filter(post => post.slug.split("/")[0] === trip.id)
      .sort((a, b) => a.data.pubDate.valueOf() - b.data.pubDate.valueOf())

    return {
      params: { trip: trip.id },
      props: { posts, trip },
    }
  })
}

type Props = {
  posts: CollectionEntry<"travel">[]
  trip: CollectionEntry<"trips">
}
const { posts, trip } = Astro.props
---

<html lang="en">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
  </head>
  <body>
    <Header />
    <Image
      src={trip.data.cover || placeholder}
      alt={trip.data.coverAlt || `A photo from the ${trip.data.title} trip`}
    />
    <main>
      <h1>{trip.data.title}</h1>
      <h2>{trip.data.years.join(" - ")}</h2>
      <ul>
        {
          posts.map(post => (
            <li>
              <a href={post.slug}>{post.data.title}</a>
            </li>
          ))
        }
      </ul>
    </main>
    <Footer />
    <style>
      img {
        width: 100%;
        max-height: 30vh;
        object-fit: cover;
        border-radius: 0;
      }

      h1 {
        text-align: center;
      }

      h2 {
        font-size: 2rem;
        text-align: center;
        margin-bottom: 4rem;
      }

      ul {
        display: grid;
        gap: 1rem;
        list-style: none;
        margin: 0;
        padding: 0;
      }
      li {
        background-color: white;
        border: 1px solid #e4e4e4;
        border-radius: 1.5rem;
        overflow: hidden;
      }
      a {
        display: block;
        background-color: white;
        padding: 1.5rem;
        text-decoration: none;
        color: currentColor;
      }
    </style>
  </body>
</html>
