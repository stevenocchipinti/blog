---
import { type CollectionEntry, getCollection } from "astro:content"
import PostLayout from "../../../layouts/PostLayout.astro"

export async function getStaticPaths() {
  const posts = await getCollection("travel")
  const trips = await getCollection("trips")

  return posts.map(post => {
    const [trip, slug] = post.slug.split("/")
    const tripPosts = posts.filter(p => p.slug.split("/")[0] === trip)
    const indexInTrip = tripPosts.indexOf(post)

    const prevPost =
      indexInTrip === 0
        ? undefined
        : `/travel/${tripPosts[indexInTrip - 1]?.slug}`
    const nextPost = tripPosts[indexInTrip + 1]?.slug
      ? `/travel/${tripPosts[indexInTrip + 1]?.slug}`
      : undefined

    return {
      params: { trip, slug },
      props: { post, prevPost, nextPost, trip: trips.find(t => t.id === trip) },
    }
  })
}

type Props = {
  post: CollectionEntry<"travel">
  trip: CollectionEntry<"trips">
  prevPost: string
  nextPost: string
}

const { post, prevPost, nextPost, trip } = Astro.props
const { Content } = await post.render()
---

<PostLayout {...post.data} prevPost={prevPost} nextPost={nextPost} trip={trip}>
  <Content />
</PostLayout>
